<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HTML Редактор</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
  --bg: #0f1724;
  --card: #0b1220;
  --text: #e6eef8;
  --btn: #3b82f6;
  --btn-hover: #2563eb;
  --save: #10b981;
  --save-hover: #059669;
}

body {
  margin: 0;
  font-family: "Inter", system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  height: 100vh;
  display: flex;
  flex-direction: column;
}

header {
  background: var(--card);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 10px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
  flex-wrap: wrap;
}

header button {
  border: none;
  background: var(--btn);
  color: #fff;
  padding: 8px 18px;
  border-radius: 8px;
  font-size: 15px;
  cursor: pointer;
  transition: 0.25s;
  font-weight: 500;
}

header button:hover {
  background: var(--btn-hover);
  transform: translateY(-1px);
}

header button.active {
  background: linear-gradient(90deg, var(--btn), #60a5fa);
}

.save-btn {
  background: var(--save);
}
.save-btn:hover {
  background: var(--save-hover);
}

main {
  flex: 1;
  position: relative;
  overflow: hidden;
}

section {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  display: none;
}

section.active {
  display: block;
}

#codeSection .CodeMirror {
  height: calc(100vh - 60px);
  font-size: 15px;
}

#previewSection iframe {
  width: 100%;
  height: calc(100vh - 60px);
  border: none;
  background: #fff;
}

@media (max-width: 720px) {
  header {
    gap: 6px;
    padding: 8px;
  }
  header button {
    flex: 1;
    font-size: 14px;
    padding: 10px 0;
  }
  .save-btn {
    flex: 1.5;
  }
}

.app-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background:#0b1220;
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 8px 0;
  box-shadow: 0 -4px 12px rgba(0,0,0,0.5);
  z-index: 1000;
}

.app-nav a {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 12px;
  color: #fff;
  text-decoration: none;
  transition: 0.3s;
}

.app-nav a.active {
  color: #3b82f6;
}

.app-nav a i {
  font-size: 20px;
  margin-bottom: 2px;
}

@media(max-width:500px){
  .app-nav a span {font-size:10px;}
  .app-nav a i {font-size:18px;}
}
</style>
</head>
<body>

<header>
  <button id="codeBtn" class="active">Код</button>
  <button id="previewBtn">Preview</button>
  <button id="saveBtn" class="save-btn">Сохранить HTML</button>
</header>

<main>
  <section id="codeSection" class="active">
    <textarea id="htmlCode" placeholder="Введите HTML-код здесь..."></textarea>
  </section>

  <section id="previewSection">
    <iframe id="preview"></iframe>
  </section>
</main>

<div class="app-nav">
  <a href="index.html" id="nav-editor"><i class="fas fa-code"></i><span>Редактор</span></a>
  <a href="compress.html" id="nav-compress"><i class="fas fa-compress-alt"></i><span>Сжать</span></a>
  <a href="profile.html" id="nav-profile"><i class="fas fa-user"></i><span>Профиль</span></a>
  <a href="converter.html" id="nav-converter"><i class="fas fa-file-export"></i><span>Конвертер</span></a>
  <a href="qr.html" id="nav-qr"><i class="fas fa-qrcode"></i><span>QR</span></a>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/htmlmixed/htmlmixed.min.js"></script>

<script>
// CodeMirror
const htmlEditor = CodeMirror.fromTextArea(document.getElementById('htmlCode'), {
  mode: "htmlmixed",
  theme: "dracula",
  lineNumbers: true,
  lineWrapping: true
});

// Вкладки
const codeBtn = document.getElementById('codeBtn');
const previewBtn = document.getElementById('previewBtn');
const saveBtn = document.getElementById('saveBtn');
const codeSection = document.getElementById('codeSection');
const previewSection = document.getElementById('previewSection');
const previewFrame = document.getElementById('preview');

codeBtn.addEventListener('click', () => {
  codeBtn.classList.add('active');
  previewBtn.classList.remove('active');
  codeSection.classList.add('active');
  previewSection.classList.remove('active');
});

previewBtn.addEventListener('click', () => {
  previewBtn.classList.add('active');
  codeBtn.classList.remove('active');
  previewSection.classList.add('active');
  codeSection.classList.remove('active');
  updatePreview();
});

function updatePreview() {
  previewFrame.srcdoc = htmlEditor.getValue();
}

// Сохранение HTML + увеличение статистики
saveBtn.addEventListener('click', () => {
  const html = htmlEditor.getValue();
  const blob = new Blob([html], { type: 'text/html' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'index.html';
  a.click();

  const current = parseInt(localStorage.getItem('stats_files') || 0);
  localStorage.setItem('stats_files', current + 1);
});

// Навигация
const current = window.location.pathname.split('/').pop().split('.')[0];
const navMap = {
  'editor':'nav-editor',
  'compress':'nav-compress',
  'profile':'nav-profile',
  'converter':'nav-converter',
  'qr':'nav-qr'
};
if(navMap[current]){
  document.getElementById(navMap[current]).classList.add('active');
}
if('serviceWorker' in navigator){
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(reg => console.log('SW зарегистрирован', reg))
      .catch(err => console.error('SW ошибка', err));
  });
}
</script>

</body>
</html>
